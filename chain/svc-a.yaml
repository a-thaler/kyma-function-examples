apiVersion: serverless.kyma-project.io/v1alpha2
kind: Function
metadata:
  name: svc-a
  labels:
    app: svc-a
spec:
  scaleConfig:
    maxReplicas: 1
    minReplicas: 1
  runtime: nodejs14
  source:
    inline:
      source: |-
        const axios = require("axios");
        module.exports = {
            main: async function (event, context) {
              let traceId=event.extensions.request.headers['x-b3-traceid']
              console.debug(`level=debug traceId=${traceId} message=Event data: ${JSON.stringify(event.data)}`);

              if(Date.now() % 2 == 0){
                res = event.extensions.response;
                res.writeHead(503,{'Content-Type': 'text/plain'});
                res.write('Bad timing!');
                res.end();
                console.error(`level=error traceId=${traceId} message=Bad timing`);
                return
              }

              await axios.post("http://svc-b.default:80", event.data);
              console.info(`level=info traceId=${traceId} message=Called svc-b`);
              return
          }
        };
      dependencies: |-
        {  
          "name": "svc-a",
          "version": "1.0.0",
          "dependencies":{
            "axios": "^0.19.0"
          }
        }
